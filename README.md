# kaggleテンプレートコード
以下にフォルダ構成やクラスの役割を記す。 

## フォルダ構成
| フォルダ名 | 説明 |
|:----|:----|
|input |train.csv、test.csvなどの入力ファイルを入れるフォルダ |
|code |計算用のコードのフォルダ |
|code_analysis |分析用のコードやJupyter Notebookのフォルダ |
|model |モデルや特徴量を保存するフォルダ |
|submission |提出用ファイルを保存するフォルダ |

## Modelクラス
xgboostやscikit-learnの各モデルをラップしたクラスであり、学習や予測を行う。  
Modelクラスを継承し、ModelXgb（xgboost）やModelNN（ニューラルネット）といったクラスを作成して使用する。  
xgboostやscikit-learnのモデルなどはそれぞれインターフェイスが異なるため、その違いをここで吸収し、また必要に応じて便利な処理を追加できるようにする。  
バギング（乱数シードを変えた複数のモデルの平均で予測値を出力する）などをモデルに組み込む場合もこのクラスで対応可能。  
以下のようにメソッドを定義する。（引数のselfは省略）
| パラメータ | 説明 |
|:----|:----|
|\_\_init\_\_(run_fold_name prms) |コンストラクタ。ランの名前とどのfoldかを組み合わせた名前とパラメータを渡す。 |
|train(tr_x, tr_y, va_x, va_y) |学習データと目的変数、バリデーションデータと目的変数を入力とし、モデルの学習を行い、保存する。 |
|predict(te_x) |バリデーションデータやテストデータを入力都市、学習済みのモデルでの予測値を返す |
|save_model() |モデルの保存 |
|load_model() |モデルの読み込み |
  

## Runnerクラス
クロスバリデーションなどを含めて学習・予測の一連の流れを行うクラスである。  
データの読み込みもここで対応する。
Modelクラスを保持し、学習・予測はModelクラスに実行させる。
外部から使用するメソッドは以下の通りである。

| パラメータ | 説明 |
|:----|:----|
|\_\_init\_\_(run_name, model_cls, features, prms) |コンストラクタ。モデルクラス、特徴量名のリスト、パラメータ（dict型）を渡す。|
|run_train_fold(i_fold) |クロスバリデーションでのfoldを指定して学習・評価を行う。ほかのメソッドから呼び出すほか、単体でも確認やパラメータ調整に用いる。 |
|run_train_cv() |クロスバリデーションでの学習。評価をおkなう。各foldのモデルの保存、精度のログ出力についても行う。 |
|run_predict_cv() |クロスバリデーションで学習した各foldのモデルの平均により、テストデータの予測を行う。あらかじめrun_train_cvを実行しておく必要がある。 |
|run_train_all() |学習データすべてで学習し、そのモデルを保存する |
|run_predict_all() |学習データすべてで学習したモデルにより、テストデータの予測を行う。あらかじめrun_train_allを実行しておく必要がある。 |

また、外部からは使用しないメソッドとして、以下がある。
| パラメータ | 説明 |
|:----|:----|
|build_model(i_fold) |foldを指定して、モデルの作成を行う。 |
|load_x_train() |学習データを読み込む。 |
|load_y_train() |学習データの目的変数を読み込む。 |
|load_x_test() |テストデータを読み込む。 |
|load_index_fold(i_fold) |foldを指定して対応するインデックスを返す。 |

## Utilクラス、Loggerクラス
UtilクラスやLoggerクラスでは、以下を行う。  
- ユーティリティメソッド  
ファイルの入出力などのユーティリティメソッドを記述する。
- ログの出力・表示  
処理のログをファイルとコンソールに出力する。  
途中で異常終了したときの原因把握や、処理に係る時間を見積したいときには、実行時刻を付けてログを残しておくと便利である。
- 計算結果の出力・表示  
各モデルのバリデーションのスコアをファイルとコンソールに出力し、集計できるようにする。



